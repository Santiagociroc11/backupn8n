{
  "active": true,
  "connections": {
    "ESTADO": {
      "main": [
        [
          {
            "node": "ASIGNA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "url",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "url": {
      "main": [
        [
          {
            "node": "mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mensaje": {
      "main": [
        [
          {
            "node": "REDIRECCION",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LINK FORM": {
      "main": [
        [
          {
            "node": "ASIGNA1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ASIGNA1": {
      "main": [
        [
          {
            "node": "BUSCA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "CONT + 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ASIGNA": {
      "main": [
        [
          {
            "node": "Sort",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CONT + 1": {
      "main": [
        [
          {
            "node": "CLIENTE +1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CLIENTE +1": {
      "main": [
        [
          {
            "node": "REGISTRO +1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "REGISTRO +1": {
      "main": [
        [
          {
            "node": "BUSCA ASESOR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BUSCA ASESOR": {
      "main": [
        [
          {
            "node": "url",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BUSCA": {
      "main": [
        [
          {
            "node": "ESTADO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-02-21T19:52:05.746Z",
  "id": "x4XqwY6icU4O7bbm",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "üü¢ [GERSSON] LINK",
  "nodes": [
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.isNotEmpty() }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "false",
                      "singleValue": true
                    },
                    "id": "16e2bc07-c05c-4e36-bd5d-d313d0d81cac"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "NUEVO"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "36834769-c9f1-4fc7-ac70-73892aeba8e3",
                    "leftValue": "={{ $json.isNotEmpty() }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "VIEJO"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -620,
        -80
      ],
      "id": "6db700bc-afb7-43ff-8083-28f15718d1ff",
      "name": "ESTADO"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "647c5210-297d-40fc-bb27-c3c8ce0ed0fa",
              "name": "url",
              "value": "=https://wa.me/{{$json.WHA_ASESOR}}",
              "type": "string"
            },
            {
              "id": "f6d04cf3-c961-4bd9-847c-7fac41fcdee8",
              "name": "mensaje_compradores",
              "value": "Hola, ya hice la compra y tengo un problema, mi nombre es",
              "type": "string"
            },
            {
              "id": "f14f4bb3-64f6-4740-916e-417e77f767b5",
              "name": "mensaje_nocompradores",
              "value": "Hola, quiero inscribirme a la terapia del dolor pero tengo unas dudas o problemas, mi nombre es",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1200,
        -60
      ],
      "id": "05b86cc8-3b5b-4e6d-9a20-b4f39b73ee82",
      "name": "url"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a3397829-8df3-4b88-91e3-cdf65ab939b4",
              "name": "mensaje",
              "value": "={{ $json[\"¬øYa compraste el curso?\"] == \"si\" ? $json.mensaje_compradores : $json.mensaje_nocompradores }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1360,
        -60
      ],
      "id": "493c45bc-6834-4a53-89e0-490d77953706",
      "name": "mensaje"
    },
    {
      "parameters": {
        "formTitle": "SOPORTE GERSSON LOPEZ",
        "formDescription": "Antes de ingresar al chat con el asesor, danos estos datos para que te puedan atender rapidamente.\n\nNo evites ning√∫n dato para poder contactarte en caso que el asesor no est√© disponible.",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Nombre",
              "placeholder": "Tu nombre",
              "requiredField": true
            },
            {
              "fieldLabel": "¬øYa compraste el curso?",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  {
                    "option": "si"
                  },
                  {
                    "option": "no"
                  }
                ]
              },
              "requiredField": true
            },
            {
              "fieldLabel": "Whastapp",
              "fieldType": "number",
              "placeholder": "Tu whatsapp con indicativo sin espacios ni +",
              "requiredField": true
            },
            {
              "fieldType": "html",
              "elementName": "titulo",
              "html": "<p>üëÜüèº Pon tu Whatsapp para el registro</p>\n\n"
            }
          ]
        },
        "options": {
          "path": "soporte-td"
        }
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.2,
      "position": [
        -1100,
        -80
      ],
      "id": "1262b446-c252-4996-bc20-f94bd1f7dd8d",
      "name": "LINK FORM",
      "webhookId": "f5aafb77-fec9-4f79-b521-cb5f7c34f0d7"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e1694f53-f949-4b5b-a117-26e31093c173",
              "name": "compra",
              "value": "={{ $json['¬øYa compraste el curso?'] }}",
              "type": "string"
            },
            {
              "id": "a706139e-ebc8-4d42-93ab-65e2e4cf848b",
              "name": "Nombre",
              "value": "={{ $json.Nombre }}",
              "type": "string"
            },
            {
              "id": "a51e8ec7-802b-42be-a956-0217e0abeb96",
              "name": "whatsapp",
              "value": "={{ $json.Whastapp }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -940,
        -80
      ],
      "id": "1ec083c8-f58d-46d6-8da6-c005ab6f45b4",
      "name": "ASIGNA1"
    },
    {
      "parameters": {
        "operation": "completion",
        "respondWith": "redirect",
        "redirectUrl": "={{ $('url').item.json.url }}?text={{ encodeURIComponent($('mensaje').item.json.mensaje) }}+{{ $('LINK FORM').item.json.Nombre }}\n"
      },
      "type": "n8n-nodes-base.form",
      "typeVersion": 1,
      "position": [
        1520,
        -60
      ],
      "id": "c7353386-de0e-4b63-aae2-cf2e0423e9e4",
      "name": "REDIRECCION",
      "webhookId": "c8fb22c9-a6bc-4f11-8b23-8dd05c2cf8ab"
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "LINK"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        -140,
        -220
      ],
      "id": "3da6e9ac-2b27-4032-b586-75eda82c26f3",
      "name": "Sort"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        20,
        -220
      ],
      "id": "adfe19f7-4afa-4e9c-bd11-d1630851587a",
      "name": "Limit"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "GERSSON_ASESORES",
        "returnAll": true
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -300,
        -220
      ],
      "id": "6e9f7516-9414-4433-9700-4f2317fe52f9",
      "name": "ASIGNA",
      "credentials": {
        "supabaseApi": {
          "id": "r7GZA4DyUQZRn267",
          "name": "DB CIERRES"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "GERSSON_ASESORES",
        "filters": {
          "conditions": [
            {
              "keyName": "ID",
              "condition": "eq",
              "keyValue": "={{ $json.ID }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "LINK",
              "fieldValue": "={{ $json.LINK + 1 }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        180,
        -220
      ],
      "id": "bf3f0f47-f5ed-4710-9332-4f85bc43560b",
      "name": "CONT + 1",
      "credentials": {
        "supabaseApi": {
          "id": "r7GZA4DyUQZRn267",
          "name": "DB CIERRES"
        }
      }
    },
    {
      "parameters": {
        "tableId": "GERSSON_CLIENTES",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "ESTADO",
              "fieldValue": "=LINK"
            },
            {
              "fieldId": "WHATSAPP",
              "fieldValue": "={{ $('ASIGNA1').item.json.whatsapp }}"
            },
            {
              "fieldId": "ID_ASESOR",
              "fieldValue": "={{ $('ASIGNA').item.json.ID }}"
            },
            {
              "fieldId": "FECHA_CREACION",
              "fieldValue": "={{ $now.toSeconds().floor() }}"
            },
            {
              "fieldId": "NOMBRE",
              "fieldValue": "={{ $('ASIGNA1').item.json.Nombre }}"
            },
            {
              "fieldId": "NOMBRE_ASESOR",
              "fieldValue": "={{ $('ASIGNA').item.json.NOMBRE }}"
            },
            {
              "fieldId": "WHA_ASESOR",
              "fieldValue": "={{ $('ASIGNA').item.json.WHATSAPP }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        360,
        -220
      ],
      "id": "ec999397-989f-4397-8067-2948afa68ade",
      "name": "CLIENTE +1",
      "credentials": {
        "supabaseApi": {
          "id": "r7GZA4DyUQZRn267",
          "name": "DB CIERRES"
        }
      }
    },
    {
      "parameters": {
        "tableId": "GERSSON_REGISTROS",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "ID_CLIENTE",
              "fieldValue": "={{ $json.ID }}"
            },
            {
              "fieldId": "TIPO_EVENTO",
              "fieldValue": "LINK"
            },
            {
              "fieldId": "FECHA_EVENTO",
              "fieldValue": "={{ $now.toSeconds().floor() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        540,
        -220
      ],
      "id": "d39c9010-6634-401d-8f36-41c19289f369",
      "name": "REGISTRO +1",
      "credentials": {
        "supabaseApi": {
          "id": "r7GZA4DyUQZRn267",
          "name": "DB CIERRES"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "GERSSON_CLIENTES",
        "limit": 1,
        "filters": {
          "conditions": [
            {
              "keyName": "WHATSAPP",
              "condition": "like",
              "keyValue": "=*{{$('LINK FORM').item.json.Whastapp.toString().slice(-6)}}*"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        740,
        -220
      ],
      "id": "702b10e0-9b0e-4533-a53b-9f1100d3bd65",
      "name": "BUSCA ASESOR",
      "credentials": {
        "supabaseApi": {
          "id": "r7GZA4DyUQZRn267",
          "name": "DB CIERRES"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "GERSSON_CLIENTES",
        "limit": 1,
        "filters": {
          "conditions": [
            {
              "keyName": "WHATSAPP",
              "condition": "like",
              "keyValue": "=*{{$('LINK FORM').item.json.Whastapp.toString().slice(-6)}}*"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -780,
        -80
      ],
      "id": "5e6ed90a-129e-4408-830a-aeb6f08f9e0b",
      "name": "BUSCA",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "r7GZA4DyUQZRn267",
          "name": "DB CIERRES"
        }
      }
    }
  ],
  "pinData": {
    "LINK FORM": [
      {
        "json": {
          "Nombre": "SANTIAGO CIRO",
          "¬øYa compraste el curso?": "no",
          "Whastapp": 573136298562,
          "titulo": "<p>üëÜüèº Pon tu Whatsapp para el registro</p>\r\n\r\n",
          "submittedAt": "2025-02-22T18:51:13.262-05:00",
          "formMode": "production"
        }
      }
    ]
  },
  "repo_name": "backupn8n",
  "repo_owner": "Santiagociroc11",
  "repo_path": "backup/",
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-02-04T22:36:35.108Z",
      "updatedAt": "2025-02-04T22:36:35.108Z",
      "id": "HjNWwvqlBnseDfSA",
      "name": "GERSSON"
    },
    {
      "createdAt": "2025-02-20T03:14:39.493Z",
      "updatedAt": "2025-02-20T03:14:39.493Z",
      "id": "fMteddKWhaFhuYHk",
      "name": "MYSQL"
    }
  ],
  "triggerCount": 2,
  "updatedAt": "2025-02-22T23:53:00.000Z",
  "versionId": "642ab7a4-f3ec-40f2-884a-46b7b526ce36"
}