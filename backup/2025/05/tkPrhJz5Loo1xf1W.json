{
  "active": false,
  "connections": {
    "Schedule Trigger1": {
      "main": [
        [
          {
            "node": "busqueda BD1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "Summarize1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "CreateGroup1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BodysCreate1": {
      "main": [
        [
          {
            "node": "ModificaNombres1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ModificaNombres1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CreateGroup1": {
      "main": [
        [
          {
            "node": "5 seg1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "5 seg1": {
      "main": [
        [
          {
            "node": "ObtenerLink1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ObtenerLink1": {
      "main": [
        [
          {
            "node": "EscribirGrupo1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EscribirGrupo1": {
      "main": [
        [
          {
            "node": "PromoveAdmins1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PromoveAdmins1": {
      "main": [
        [
          {
            "node": "Config",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Config": {
      "main": [
        [
          {
            "node": "Config3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Config3": {
      "main": [
        [
          {
            "node": "Setfoto1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Setfoto1": {
      "main": [
        [
          {
            "node": "Encontrar participantes do grupo1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busqueda BD1": {
      "main": [
        [
          {
            "node": "grupos vacios1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "grupos vacios1": {
      "main": [
        [
          {
            "node": "conteo grupos vacios1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "conteo grupos vacios1": {
      "main": [
        [
          {
            "node": "# del ultimo grupo1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "# del ultimo grupo1": {
      "main": [
        [
          {
            "node": "hay menos de 3 grupos?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "hay menos de 3 grupos?1": {
      "main": [
        [
          {
            "node": "obtener datos de creacion1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener datos de creacion1": {
      "main": [
        [
          {
            "node": "establecer variables1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "establecer variables1": {
      "main": [
        [
          {
            "node": "BodysCreate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize1": {
      "main": [
        [
          {
            "node": "Telegram1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualizar membros do grupo3": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Atualizar membros do grupo4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Atualizar membros do grupo5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualizar membros do grupo4": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualizar membros do grupo5": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Atualizar membros do grupo3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Encontrar participantes do grupo1": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-05-04T03:28:13.731Z",
  "id": "tkPrhJz5Loo1xf1W",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "[GERSSON] AUTO CREACIÓN DE GRUPOS",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 6
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -3216,
        272
      ],
      "id": "44a39775-3167-46a7-bb09-dca200eb035b",
      "name": "Schedule Trigger1"
    },
    {
      "parameters": {
        "batchSize": "=1",
        "options": {}
      },
      "id": "cf44caab-bae2-449b-9db7-2e8c7e8aa07d",
      "name": "Loop Over Items1",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -976,
        272
      ]
    },
    {
      "parameters": {
        "jsCode": "// Obtener todos los items de un nodo anterior\nconst adminsArray = $input.all();\n\nconst subject = adminsArray[0]?.json['nombre'] || '';\nconst description = adminsArray[0]?.json['descripcion'] || '';\n\n// Obtener la lista de creadores (nombres de sesión)\nconst sesionesCreadores = adminsArray[0]?.json['sesiones creadoras'].split(',').map(s => s.trim());\n\n// Obtener el mapeo creador -> admin\nconst mapeoStr = adminsArray[0]?.json['mapeo_creador_admin'];\nconst mapeo = {};\nmapeoStr.split(',').forEach(par => {\n  const [creador, admin] = par.split(':');\n  mapeo[creador.trim()] = admin.trim();\n});\n\n// Extraer los admins\nconst todosLosAdmins = adminsArray[0]?.json['admins'].split(',').map(admin => admin.trim());\n\n// Crear array de datos\nconst items = [];\nconst cantidad = adminsArray[0].json['cantidad'];\n\nfor (let i = 0; i < cantidad; i++) {\n  const indiceCreador = i % sesionesCreadores.length;\n  const creadorActual = sesionesCreadores[indiceCreador];\n  \n  // Obtener el NÚMERO del creador desde el mapeo\n  const numeroCreador = mapeo[creadorActual];\n  \n  // Filtrar participantes: excluir al número del creador\n  const participantesFiltrados = todosLosAdmins.filter(admin => admin !== numeroCreador);\n  \n  items.push({\n    json: {\n      subject: subject,\n      description: description,\n      participants: participantesFiltrados,\n      _creador: creadorActual,\n      _indiceCreador: indiceCreador\n    }\n  });\n}\n\nreturn items;"
      },
      "id": "c3cc5943-61d1-42e1-8d90-581a581d3afe",
      "name": "BodysCreate1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1424,
        272
      ]
    },
    {
      "parameters": {
        "jsCode": "// Obtener el contador inicial del nodo anterior\nconst contadorInicial = $('# del ultimo grupo1').first().json.conteo_grupo + 1;\n\n// Obtener los items del nodo BodysCreate1\nconst items = $('BodysCreate1').all();\n\n// Actualizar items con contador incremental\nconst updatedItems = items.map((item, index) => {\n  const updatedItem = { ...item.json };\n  updatedItem.subject = `${updatedItem.subject} #${contadorInicial + index}`;\n  return { json: updatedItem };\n});\n\nreturn updatedItems;"
      },
      "id": "34587728-ee1d-4330-853d-13fb2e46fe1b",
      "name": "ModificaNombres1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1200,
        272
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution.automscc.com/group/create/{{$('Loop Over Items1').item.json._creador}}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.toJsonString() }}",
        "options": {}
      },
      "id": "940c90f9-5784-4caa-9afe-938b7f7e8145",
      "name": "CreateGroup1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -752,
        272
      ]
    },
    {
      "parameters": {},
      "id": "76466844-696c-4383-9a48-e71be7124284",
      "name": "5 seg1",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -528,
        272
      ],
      "webhookId": "5a1e03a6-5052-4f92-b342-aee6ce6ce8ea"
    },
    {
      "parameters": {
        "url": "=https://evolution.automscc.com/group/inviteCode/{{$('Loop Over Items1').item.json._creador}}?groupJid={{ $json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "options": {}
      },
      "id": "c9be78dc-bfd0-46a5-a37b-92d539c78817",
      "name": "ObtenerLink1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -304,
        272
      ]
    },
    {
      "parameters": {
        "table": {
          "__rl": true,
          "value": "={{ $('establecer variables1').all()[0].json.TABLA_BD }}",
          "mode": "name"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "nombre",
              "value": "={{ $('CreateGroup1').all()[0].json.subject }}"
            },
            {
              "column": "link",
              "value": "={{ $json.inviteUrl }}"
            },
            {
              "column": "id",
              "value": "={{ $('CreateGroup1').item.json.id }}"
            },
            {
              "column": "Total",
              "value": "0"
            },
            {
              "column": "bienvenida",
              "value": "no"
            },
            {
              "column": "creador",
              "value": "={{ $('establecer variables1').item.json['sesiones creadoras'].split(\",\")[$runIndex] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "8d501988-8134-4845-9649-af37f2447433",
      "name": "EscribirGrupo1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        -80,
        272
      ],
      "credentials": {
        "mySql": {
          "id": "179b2UX7XsHkNW05",
          "name": "REDIRECCIONES - LANZAMIENTOS"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution.automscc.com/group/updateParticipant/{{$('Loop Over Items1').item.json._creador}}?groupJid={{ $('CreateGroup1').item.json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"action\": \"promote\",\n  \"participants\": {{ $('Loop Over Items1').item.json['participants'].toJsonString() }}\n}",
        "options": {}
      },
      "id": "f78a1418-63ee-46ec-abd2-46cc8c2aeb97",
      "name": "PromoveAdmins1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        144,
        272
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution.automscc.com/group/updateSetting/{{$('Loop Over Items1').item.json._creador}}?groupJid={{ $('CreateGroup1').item.json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"action\": \"announcement\"\n}",
        "options": {}
      },
      "id": "effa279e-22a4-4d07-99a0-8b53a35a3181",
      "name": "Config",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        368,
        272
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution.automscc.com/group/updateSetting/{{$('Loop Over Items1').item.json._creador}}?groupJid={{ $('CreateGroup1').item.json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"action\": \"locked\"\n}",
        "options": {}
      },
      "id": "fd429770-c09d-43e5-be5d-e417bd10fc22",
      "name": "Config3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        592,
        272
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution.automscc.com/group/updateGroupPicture/{{$('Loop Over Items1').item.json._creador}}?groupJid={{ $('CreateGroup1').item.json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"image\": \"{{ $('establecer variables1').first().json.url_imagen }}\"\n}",
        "options": {}
      },
      "id": "156c60ea-233b-46e5-ba18-9f379fbe56bc",
      "name": "Setfoto1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        816,
        272
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "GERSSON_LINKS",
          "mode": "list",
          "cachedResultName": "GERSSON_LINKS"
        },
        "returnAll": true,
        "sort": {
          "values": [
            {
              "column": "#",
              "direction": "DESC"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        -2992,
        272
      ],
      "id": "ad98c785-c1e8-4a85-8781-522b90e41820",
      "name": "busqueda BD1",
      "credentials": {
        "mySql": {
          "id": "179b2UX7XsHkNW05",
          "name": "REDIRECCIONES - LANZAMIENTOS"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "573915c0-241e-4857-be6f-098c4b898057",
              "leftValue": "={{ 1000 - $json.Total }}",
              "rightValue": 500,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -2768,
        272
      ],
      "id": "1d067b5f-0985-4b74-a424-bc2237ee8e8e",
      "name": "grupos vacios1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "field": "id"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1.1,
      "position": [
        -2544,
        272
      ],
      "id": "e441000b-ca52-449f-80eb-46c729bfcb5a",
      "name": "conteo grupos vacios1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2d7cdac5-d2b8-4566-8f63-3176f52ea52e",
              "name": "conteo_grupo",
              "value": "={{ $('busqueda BD1').first().json.nombre.match(/#(\\d+)/)[1] }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2320,
        272
      ],
      "id": "f7cc954a-1d8e-4c7d-aaf6-612aa6897fe0",
      "name": "# del ultimo grupo1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "cd476138-de67-4790-b014-a96284459560",
              "leftValue": "={{ $('conteo grupos vacios1').first().json.count_id }}",
              "rightValue": 3,
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2096,
        272
      ],
      "id": "1921a7a6-799e-4cbe-af90-6bccb99d9974",
      "name": "hay menos de 3 grupos?1"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "1e900880-d85d-8045-8cec-cf9803d42c6e",
          "mode": "list",
          "cachedResultName": "TABLA GRUPOS",
          "cachedResultUrl": "https://www.notion.so/1e900880d85d80458ceccf9803d42c6e"
        },
        "returnAll": true,
        "filterType": "manual",
        "filters": {
          "conditions": [
            {
              "key": "LANZAMIENTO|title",
              "condition": "equals",
              "titleValue": "GERSSON"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        -1872,
        272
      ],
      "id": "5ad878a3-0ceb-4f54-b522-3b8e1b9f1b1a",
      "name": "obtener datos de creacion1",
      "credentials": {
        "notionApi": {
          "id": "96gd5czBYIXX6Aw7",
          "name": "NOTION SANTIAGO"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "933a219e-5da4-4dd5-bfaa-af884816b358",
              "name": "admins",
              "value": "={{ $json.property_admins }}",
              "type": "string"
            },
            {
              "id": "0080bd4c-5a10-4a5f-aea0-da49cb470fb5",
              "name": "sesiones creadoras",
              "value": "={{ $json.property_sesion_creadora }}",
              "type": "string"
            },
            {
              "id": "22e4f59d-b064-4733-8bf6-e6bef0239d8f",
              "name": "url_imagen",
              "value": "={{ $json.property_imagen_grupos }}",
              "type": "string"
            },
            {
              "id": "20766276-0fee-4abf-98f5-9cbc182a9a9b",
              "name": "nombre",
              "value": "={{ $json.property_nombre_grupos }}",
              "type": "string"
            },
            {
              "id": "17dace3d-8455-4b94-8263-e87c4cf7a0dd",
              "name": "descripcion",
              "value": "={{ $json.property_descripci_n }}",
              "type": "string"
            },
            {
              "id": "84b1b411-ae75-4f1a-9ae8-c01bfcafa65b",
              "name": "sesion admins",
              "value": "={{ $json.property_sesion_admins }}",
              "type": "string"
            },
            {
              "id": "02ec7072-ce8e-491a-b32c-a4eb04f3c2b0",
              "name": "cantidad",
              "value": 5,
              "type": "number"
            },
            {
              "id": "806804b0-39a4-4461-a004-ee13cdfcb0f7",
              "name": "TABLA_BD",
              "value": "={{ $json.property_tabla_bd }}",
              "type": "string"
            },
            {
              "id": "4c32d186-8616-475d-8eae-12b8cbe2f740",
              "name": "mapeo_creador_admin",
              "value": "SANTIAGO-PERSONAL:573136298562,JUANCA_CREADOR:573017817643,SANTIAGO2_CREADOR:573166620443,FRAN_CREADOR:573218504711,YEZDE_DOLOR:573245207576",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1648,
        272
      ],
      "id": "3aec7bd5-887b-493c-9837-15c8a05465bc",
      "name": "establecer variables1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2384,
        416
      ],
      "id": "b51c6241-2aff-4d58-9cba-eb67f9e8ce56",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {
        "chatId": "-1002176532359",
        "text": "=⚡ * {{ ($json.count_data) }} GRUPOS CREADOS AUTOMATICAMENTE* ⚡\n\nAGREGAR ADMINS FALTANTES",
        "additionalFields": {
          "appendAttribution": false,
          "message_thread_id": 697
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -528,
        80
      ],
      "id": "7c744a01-0794-47a4-9347-fe186cec72e3",
      "name": "Telegram1",
      "webhookId": "376e263b-2a85-4e61-b23d-9a28eb9ad795",
      "credentials": {
        "telegramApi": {
          "id": "QruLAfRq4u80XCVX",
          "name": "BOT AGENCIA X"
        }
      }
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "field": "data",
              "includeEmpty": true
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1.1,
      "position": [
        -752,
        80
      ],
      "id": "98bf6b36-7113-4e03-a23f-2f0f4f821c48",
      "name": "Summarize1"
    },
    {
      "parameters": {
        "jsCode": "// Obtener los participants del item actual del loop que viene en el flujo\n// Como estamos dentro del loop, el item actual viene con toda la info\nconst loopItem = $input.all()[0].json;\n\n// Los participants esperados deberían venir de algún nodo previo\n// Intentemos obtenerlos del nodo CreateGroup que tiene el item original\nconst requiredAdminData = loopItem.participants || $(\"Loop Over Items1\").first().json.participants;\n\n// Convertir a array si es string\nconst requiredAdminNumbers = Array.isArray(requiredAdminData) \n  ? requiredAdminData \n  : requiredAdminData.split(',').map(n => n.trim());\n\n// Los participants del grupo vienen de \"Encontrar participantes\"\nconst inputData = $input.all()[0].json;\n\nif (!inputData || !inputData.data || !inputData.data.participants) {\n  throw new Error(\"La estructura de datos no es la esperada.\");\n}\n\nconst participants = inputData.data.participants;\n\n// Crear mapa\nconst participantsMap = new Map();\nfor (const p of participants) {\n  const numberOnly = p.id.split('@')[0];\n  participantsMap.set(numberOnly, p);\n}\n\n// Comparar\nlet numeros_faltantes_array = [];\nlet admins_faltantes_array = [];\n\nfor (const adminNumber of requiredAdminNumbers) {\n  const cleanNumber = adminNumber.trim();\n  \n  if (participantsMap.has(cleanNumber)) {\n    const participant = participantsMap.get(cleanNumber);\n    if (!participant.admin) {\n      admins_faltantes_array.push(cleanNumber);\n    }\n  } else {\n    numeros_faltantes_array.push(cleanNumber);\n  }\n}\n\nconst completo = numeros_faltantes_array.length === 0 && admins_faltantes_array.length === 0;\n\nreturn [{\n  json: {\n    completo: completo,\n    numeros_faltantes: numeros_faltantes_array.join(','),\n    admins_faltantes: admins_faltantes_array.join(','),\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1264,
        272
      ],
      "id": "b756ecf7-8801-4fd7-8522-1efc86d592cb",
      "name": "Code1"
    },
    {
      "parameters": {
        "resource": "groups-api",
        "operation": "update-participants",
        "instanceName": "={{ $('establecer variables1').first().json['sesion admins'] }}",
        "groupJid": "={{ $('CreateGroup1').item.json.id }}",
        "action": "promote",
        "participants": "={{ $('Switch1').item.json.numeros_faltantes }}"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        2160,
        80
      ],
      "id": "1ff1d9fb-e38b-413a-bf78-35001bbde32e",
      "name": "Atualizar membros do grupo3",
      "credentials": {
        "evolutionApi": {
          "id": "Png3VbsnUeyqI5UL",
          "name": "VPS-EASYPANEL"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.numeros_faltantes }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    },
                    "id": "f1712e69-35cb-4ba2-9123-64adc6687970"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "PARTICIPANTES FALTANTES"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7ed79f77-fb49-42e4-a71d-a84d4aa1600f",
                    "leftValue": "={{ $json.admins_faltantes }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ADMINS_FALTANTES"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fcbfe47d-e82a-4ab0-960f-c0c49468386a",
                    "leftValue": "={{ $json.completo }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "COMPLETO"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1488,
        256
      ],
      "id": "beb843da-841e-4cc3-8822-18ff71bd91c4",
      "name": "Switch1"
    },
    {
      "parameters": {
        "resource": "groups-api",
        "operation": "update-participants",
        "instanceName": "={{ $('establecer variables1').first().json['sesion admins'] }}",
        "groupJid": "={{ $('CreateGroup1').item.json.id }}",
        "participants": "={{ $json.numeros_faltantes }}"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1712,
        80
      ],
      "id": "e7d400df-10d2-4098-92b5-ffe7c0ee6357",
      "name": "Atualizar membros do grupo4",
      "credentials": {
        "evolutionApi": {
          "id": "Png3VbsnUeyqI5UL",
          "name": "VPS-EASYPANEL"
        }
      }
    },
    {
      "parameters": {
        "resource": "groups-api",
        "operation": "update-participants",
        "instanceName": "={{ $('establecer variables1').first().json['sesion admins'] }}",
        "groupJid": "={{ $('CreateGroup1').item.json.id }}",
        "action": "promote",
        "participants": "={{ $json.admins_faltantes }}"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        2160,
        272
      ],
      "id": "3bbdf11a-4d5c-4691-94cc-ef991178403f",
      "name": "Atualizar membros do grupo5",
      "credentials": {
        "evolutionApi": {
          "id": "Png3VbsnUeyqI5UL",
          "name": "VPS-EASYPANEL"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1936,
        80
      ],
      "id": "208f2983-95b3-4d05-a957-4630c01e507b",
      "name": "Wait1",
      "webhookId": "cf541d9f-e5d9-4817-9202-a8e8bff6860c"
    },
    {
      "parameters": {
        "resource": "groups-api",
        "operation": "find-participants",
        "instanceName": "={{$('Loop Over Items1').item.json._creador}}",
        "groupJid": "={{ $('CreateGroup1').item.json.id }}"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1040,
        272
      ],
      "id": "d243ff84-5761-4c99-82c6-458c4d85deae",
      "name": "Encontrar participantes do grupo1",
      "credentials": {
        "evolutionApi": {
          "id": "Png3VbsnUeyqI5UL",
          "name": "VPS-EASYPANEL"
        }
      }
    }
  ],
  "pinData": {
    "Schedule Trigger1": [
      {
        "json": {
          "timestamp": "2025-08-05T18:00:24.005-05:00",
          "Readable date": "August 5th 2025, 6:00:24 pm",
          "Readable time": "6:00:24 pm",
          "Day of week": "Tuesday",
          "Year": "2025",
          "Month": "August",
          "Day of month": "05",
          "Hour": "18",
          "Minute": "00",
          "Second": "24",
          "Timezone": "America/Bogota (UTC-05:00)"
        }
      }
    ]
  },
  "repo_name": "backupn8n",
  "repo_owner": "Santiagociroc11",
  "repo_path": "backup/",
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": {
    "node:Schedule Trigger": {
      "recurrenceRules": [
        0
      ]
    },
    "node:Schedule Trigger1": {
      "recurrenceRules": []
    }
  },
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-10-07T00:21:19.000Z",
  "versionId": "8759eb7d-ad5c-4b63-a846-a63c1c87baf7"
}