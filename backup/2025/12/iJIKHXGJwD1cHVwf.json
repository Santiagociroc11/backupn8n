{
  "active": true,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "encontrar": {
      "main": [
        [
          {
            "node": "tag manychat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing": {
      "main": [
        [
          {
            "node": "encontrar",
            "type": "main",
            "index": 0
          },
          {
            "node": "escritura",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-12-18T04:54:49.490Z",
  "id": "iJIKHXGJwD1cHVwf",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "ðŸŸ¢ [REISY] ESCRITURA Y EXPULSION DE GRUPOS",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sendflow-hook-reisy",
        "options": {}
      },
      "id": "1d42995c-c50d-4a20-9a7d-1ea1a4ad9e46",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        880,
        368
      ],
      "webhookId": "0026ddf5-181e-42c9-8542-c14cd3f23fb2"
    },
    {
      "parameters": {
        "collection": "=L1-REG-PRINCIPAL",
        "options": {
          "limit": 1
        },
        "query": "={\n  \"whatsapp\": {\n    \"$regex\": \".*{{ $('Edit Fields').item.json.numero.replace(/\\D/g, \"\").slice(-6) }}\",\n    \"$options\": \"i\"\n  }\n}"
      },
      "id": "6f678692-5035-4285-8aa6-7f81f8154e30",
      "name": "encontrar",
      "type": "n8n-nodes-base.mongoDb",
      "typeVersion": 1.1,
      "position": [
        1776,
        272
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mongoDb": {
          "id": "j2YBNujqV7oGjDE8",
          "name": "DB REISY"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.manychat.com/fb/subscriber/addTagByName",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 417343:0df1fbec4fde1bef06f40cdc3244cfb1"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"subscriber_id\": {{ $json.id_manychat }},\n  \"tag_name\": \"L1-INGRESOGRUPO\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2000,
        272
      ],
      "id": "04c87d81-f3ed-404a-96ae-05bbf8b4fc29",
      "name": "tag manychat",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "maxTries": 5,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1552,
        368
      ],
      "id": "54acd554-9a74-45b5-88c9-d420abf3d0d3",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "operation": "upsert",
        "table": {
          "__rl": true,
          "value": "REISY_L1_WHA",
          "mode": "list",
          "cachedResultName": "REISY_L1_WHA"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "whatsapp",
        "valueToMatchOn": "={{ $('Edit Fields').item.json.numero.replace(/\\D/g, '') }}",
        "valuesToSend": {
          "values": [
            {
              "column": "dia",
              "value": "={{ $now.format('yyyy-MM-dd') }}"
            },
            {
              "column": "hora",
              "value": "={{ $now.format('HH:mm:ss') }}"
            },
            {
              "column": "grupo",
              "value": "={{ $('Edit Fields').item.json.grupo }}"
            },
            {
              "column": "nombre_grupo",
              "value": "={{ $('Webhook').item.json.body.data.groupName }}"
            },
            {
              "column": "fuente",
              "value": "FB ADS"
            }
          ]
        },
        "options": {
          "detailedOutput": true
        }
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1776,
        464
      ],
      "id": "54f48285-ee63-4f48-bb35-cc50aa00a6ae",
      "name": "escritura",
      "credentials": {
        "mySql": {
          "id": "n8fCALXWnGdmJkBN",
          "name": "CAPTACIONES"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.event }}",
                    "rightValue": "group.updated.members.added",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "9b8a9d43-676c-4650-8bb4-8fdf83b75d19"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "MIEMBRO AÃ‘ADIDO"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ebcbf54b-9f2a-4246-9c50-9a0b6d4e6bf9",
                    "leftValue": "={{ $json.body.event }}",
                    "rightValue": "messages.upsert",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "MIEMBRO ELIMINADO"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1104,
        368
      ],
      "id": "7ab0348c-65d8-451d-b205-cdbe548b87a4",
      "name": "Switch"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ffaf95ee-b40d-432a-9617-9c7a4dff4ed5",
              "name": "grupo",
              "value": "={{ $json.body.data.groupJid }}",
              "type": "string"
            },
            {
              "id": "e3a70e61-aa10-4899-baff-8492afba8c37",
              "name": "numero",
              "value": "={{ $json.body.data.number }}",
              "type": "string"
            },
            {
              "id": "05f7d46c-8fc2-4fc3-8cfe-c7cc00bed18b",
              "name": "accion",
              "value": "=INGRESO",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "afee8377-38fd-4a85-a530-d183a16c7559",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1328,
        368
      ]
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "n8n.automscc.com",
            "user-agent": "axios/0.27.2",
            "content-length": "387",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, br",
            "cdn-loop": "cloudflare; loops=1",
            "cf-connecting-ip": "2600:1900:0:2a02::900",
            "cf-ipcountry": "BR",
            "cf-ray": "9afc12f34b70ac02-GRU",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "content-type": "application/json",
            "sendtok": "00EC1A82DDDCFC6A1E9311AF25F6F19A506FD131D3",
            "x-forwarded-for": "2600:1900:0:2a02::900, 104.23.254.183",
            "x-forwarded-host": "n8n.automscc.com",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "3a6a6ec7bbe4",
            "x-real-ip": "104.23.254.183"
          },
          "params": {},
          "query": {},
          "body": {
            "id": "esvcZf5VrismbfroIlxS",
            "event": "group.updated.members.added",
            "data": {
              "campaignId": "AAAAAAAAAAAAAAAAAAAA",
              "campaignName": "Campanha Natal",
              "createdAt": "2025-12-18T04:56:29.882Z",
              "createdAt_with_timezone_br": "2021-10-01T00:00:00.000-03:00",
              "groupId": "000000000000000000",
              "groupJid": "000000000000000000@g.us",
              "groupName": "Grupo de Natal #1",
              "number": "0000000000000"
            },
            "version": "1.0.0"
          },
          "webhookUrl": "https://n8n.automscc.com/webhook/sendflow-hook-reisy",
          "executionMode": "production"
        }
      }
    ]
  },
  "repo_name": "backupn8n",
  "repo_owner": "Santiagociroc11",
  "repo_path": "backup/",
  "settings": {
    "executionOrder": "v1",
    "timezone": "America/Bogota",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "shared": [
    {
      "updatedAt": "2025-12-18T04:54:49.496Z",
      "createdAt": "2025-12-18T04:54:49.496Z",
      "role": "workflow:owner",
      "workflowId": "iJIKHXGJwD1cHVwf",
      "projectId": "703bt8e3CRxfBTYZ"
    }
  ],
  "staticData": null,
  "tags": [
    {
      "updatedAt": "2025-02-20T03:14:39.493Z",
      "createdAt": "2025-02-20T03:14:39.493Z",
      "id": "fMteddKWhaFhuYHk",
      "name": "MYSQL"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-12-20T04:02:00.000Z",
  "versionId": "ce68da35-a764-4500-9613-81a56f1b8514"
}