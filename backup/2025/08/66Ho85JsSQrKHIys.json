{
  "active": false,
  "connections": {
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar grupos": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Atualizar nome do grupo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualizar nome do grupo": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "Update row in sheet",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Encontrar participantes do grupo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Encontrar participantes do grupo": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-08-17T20:08:59.376Z",
  "id": "66Ho85JsSQrKHIys",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "EXTRACTOR GRUPOS EVOLUTION API",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -624,
        432
      ],
      "id": "bf2e827e-6aaa-4aa6-b1ef-634629633ea2",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "resource": "groups-api",
        "operation": "fetch-groups",
        "instanceName": "SANTIAGO-PERSONAL",
        "searchMethod": "fetchAll"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -752,
        -160
      ],
      "id": "a74ea7d7-eb08-451b-b6ed-a250d113c16f",
      "name": "Buscar grupos",
      "credentials": {
        "evolutionApi": {
          "id": "Png3VbsnUeyqI5UL",
          "name": "VPS-EASYPANEL"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -528,
        -160
      ],
      "id": "7fe1b343-74e7-4608-88c4-014c5548ccf6",
      "name": "Split Out"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1o_MPnwjTJ9PfmCZiz76o8arlmnwvWTD8m7dP-01U8t0",
          "mode": "list",
          "cachedResultName": "GRUPOS SANTIAGO-PERSONAL",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1o_MPnwjTJ9PfmCZiz76o8arlmnwvWTD8m7dP-01U8t0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Hoja 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1o_MPnwjTJ9PfmCZiz76o8arlmnwvWTD8m7dP-01U8t0/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ID": "={{ $json.id }}",
            "NOMBRE": "={{ $json.subject }}",
            "CREADOR": "={{ $json.owner }}",
            "ID_CREACION": "={{ $json.creation }}",
            "COMUNIDAD": "={{ $json.isCommunity }}",
            "PARTICIPANTES": "={{ $json.size }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "NOMBRE",
              "displayName": "NOMBRE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "CREADOR",
              "displayName": "CREADOR",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "ID_CREACION",
              "displayName": "ID_CREACION",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "COMUNIDAD",
              "displayName": "COMUNIDAD",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "PARTICIPANTES",
              "displayName": "PARTICIPANTES",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "useAppend": true
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -304,
        -160
      ],
      "id": "7e37dce7-c643-42fd-8edd-272d381bb7da",
      "name": "Append row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zruD3ONGC9HU2i7s",
          "name": "CUENTA SANTIAGO"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1o_MPnwjTJ9PfmCZiz76o8arlmnwvWTD8m7dP-01U8t0",
          "mode": "list",
          "cachedResultName": "GRUPOS SANTIAGO-PERSONAL",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1o_MPnwjTJ9PfmCZiz76o8arlmnwvWTD8m7dP-01U8t0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Hoja 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1o_MPnwjTJ9PfmCZiz76o8arlmnwvWTD8m7dP-01U8t0/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -752,
        144
      ],
      "id": "7ee113e8-ea4f-4955-8c28-f6560de651a8",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zruD3ONGC9HU2i7s",
          "name": "CUENTA SANTIAGO"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "432f214e-4d9b-4d79-8d3b-501bb756f197",
              "leftValue": "={{ $json.COMUNIDAD }}",
              "rightValue": "FALSE",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -528,
        144
      ],
      "id": "07f9dc35-a88e-43fa-8d6f-fc5c801aa318",
      "name": "Filter",
      "disabled": true
    },
    {
      "parameters": {
        "resource": "groups-api",
        "operation": "update-group-name",
        "instanceName": "TM-1",
        "groupJid": "={{ $json.ID }}",
        "subject": "=[VIP-COM] Semana: Terapia del dolor #{{ $runIndex + 1 }}"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -80,
        64
      ],
      "id": "64c0fbcd-add2-405c-8905-df429b506f9c",
      "name": "Atualizar nome do grupo",
      "credentials": {
        "evolutionApi": {
          "id": "Png3VbsnUeyqI5UL",
          "name": "VPS-EASYPANEL"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -304,
        144
      ],
      "id": "264a27d2-2f49-4252-aca6-2dde5e9187f3",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        144,
        144
      ],
      "id": "785d6b46-92e4-4625-8949-42751d3ca6f7",
      "name": "Wait",
      "webhookId": "9f2dd8c2-6796-41e7-93f7-a47d25c45d42"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1o_MPnwjTJ9PfmCZiz76o8arlmnwvWTD8m7dP-01U8t0",
          "mode": "list",
          "cachedResultName": "GRUPOS SANTIAGO-PERSONAL",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1o_MPnwjTJ9PfmCZiz76o8arlmnwvWTD8m7dP-01U8t0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Hoja 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1o_MPnwjTJ9PfmCZiz76o8arlmnwvWTD8m7dP-01U8t0/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -400,
        432
      ],
      "id": "cf278fb3-e98c-49c2-8ad6-91917808e361",
      "name": "Get row(s) in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zruD3ONGC9HU2i7s",
          "name": "CUENTA SANTIAGO"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -80,
        432
      ],
      "id": "7329b8d1-b7c6-4f7c-8c74-427644e04305",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "jsCode": "// Lista de Admins proveniente del formulario (string separado por comas, sin espacios)\nlet adminsFromForm = \"573012451755,573017817643,573058176936,573136298562,573160436184,573160780201,573218504711,573245207576,573245904626\";\nlet adminsArray = adminsFromForm.split(\",\").map(a => a.replace(/\\D/g, \"\")); // solo dígitos\n\n// Entrada del nodo anterior: $input.first().json.data.participants (array de { id, admin, ... })\nlet inputJson = $input.first().json.data.participants || [];\n\n// Normalizar participantes (solo dígitos en id)\nlet participantsArray = inputJson.map(p => ({\n  id: String(p.id || \"\").replace(/\\D/g, \"\"),\n  admin: p.admin\n}));\n\n// 1) Admins que TIENE el grupo actualmente\nlet groupAdminsArray = participantsArray\n  .filter(p => p.id && p.admin != null && p.admin !== false) // admin presente/verdadero\n  .map(p => p.id);\n\n// 2) Admins de la lista que FALTAN en el grupo\nlet participantIdsSet = new Set(participantsArray.map(p => p.id));\nlet missingAdminsArray = adminsArray.filter(a => !participantIdsSet.has(a));\n\n// 3) Admins del grupo que NO están en la lista (diferentes)\nlet adminsSet = new Set(adminsArray);\nlet differentAdminsArray = groupAdminsArray.filter(a => !adminsSet.has(a));\n\n// Respuesta en el formato pedido (comas, sin espacios)\nreturn {\n  json: {\n    groupAdmins: groupAdminsArray.join(\",\"),\n    missingAdmins: missingAdminsArray.join(\",\"),\n    differentAdmins: differentAdminsArray.join(\",\")\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        432,
        528
      ],
      "id": "888c41eb-8c30-4a81-9f82-ef041108304e",
      "name": "Code"
    },
    {
      "parameters": {
        "resource": "groups-api",
        "operation": "find-participants",
        "instanceName": "=SANTIAGO-PERSONAL",
        "groupJid": "={{ $json.ID }}"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        208,
        528
      ],
      "id": "4125c331-3afa-466c-a3bc-da9fdcadb988",
      "name": "Encontrar participantes do grupo",
      "credentials": {
        "evolutionApi": {
          "id": "Png3VbsnUeyqI5UL",
          "name": "VPS-EASYPANEL"
        }
      }
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        864,
        576
      ],
      "id": "c83e6286-3fa1-49da-945e-af246191a238",
      "name": "Wait1",
      "webhookId": "604b7ba7-13ab-4e3f-9a80-48373fa63dae"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "71a7b681-ae18-4ab4-840c-dbedcdc9139c",
              "name": "ADMINS",
              "value": "={{ $json.groupAdmins }}",
              "type": "string"
            },
            {
              "id": "f38a5ec7-bb36-42fc-8742-648fa24a13c3",
              "name": "FALTAN",
              "value": "={{ $json.missingAdmins }}",
              "type": "string"
            },
            {
              "id": "d31b702c-f34f-46ef-a781-8f3f19fa1d45",
              "name": "EXTRAS",
              "value": "={{ $json.differentAdmins }}",
              "type": "string"
            },
            {
              "id": "9880dacc-8d92-4289-be27-75d2aa11726f",
              "name": "FILA",
              "value": "={{ $('Loop Over Items1').item.json.row_number}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        640,
        528
      ],
      "id": "700d643d-8dd3-4219-8804-e8b37f5934de",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1o_MPnwjTJ9PfmCZiz76o8arlmnwvWTD8m7dP-01U8t0",
          "mode": "list",
          "cachedResultName": "GRUPOS SANTIAGO-PERSONAL",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1o_MPnwjTJ9PfmCZiz76o8arlmnwvWTD8m7dP-01U8t0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Hoja 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1o_MPnwjTJ9PfmCZiz76o8arlmnwvWTD8m7dP-01U8t0/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $json.FILA }}",
            "ADMINS": "={{ $json.ADMINS }}",
            "FALTAN": "={{ $json.FALTAN }}",
            "EXTRAS": "={{ $json.EXTRAS }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "NOMBRE",
              "displayName": "NOMBRE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "CREADOR",
              "displayName": "CREADOR",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ID_CREACION",
              "displayName": "ID_CREACION",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "COMUNIDAD",
              "displayName": "COMUNIDAD",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "PARTICIPANTES",
              "displayName": "PARTICIPANTES",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "LANZAMIENTO",
              "displayName": "LANZAMIENTO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ADMINS",
              "displayName": "ADMINS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "FALTAN",
              "displayName": "FALTAN",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "EXTRAS",
              "displayName": "EXTRAS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        208,
        368
      ],
      "id": "5292e428-a5b3-4d5e-b2a3-2ec0d0a3e8e1",
      "name": "Update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zruD3ONGC9HU2i7s",
          "name": "CUENTA SANTIAGO"
        }
      }
    }
  ],
  "pinData": {},
  "repo_name": "backupn8n",
  "repo_owner": "Santiagociroc11",
  "repo_path": "backup/",
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-08-19T18:36:58.000Z",
  "versionId": "0d34cd79-5e1a-4bf5-b10d-71665ef1fdfe"
}