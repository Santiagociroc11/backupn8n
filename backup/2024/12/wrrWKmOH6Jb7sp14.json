{
  "active": true,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets": {
      "main": [
        [],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait4": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Wait4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-12-27T17:52:58.712Z",
  "id": "wrrWKmOH6Jb7sp14",
  "isArchived": false,
  "meta": null,
  "name": "ðŸŸ¢ [SANTIAGO] WEBHOOKS SMS - TRANSFIYA",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sms-transfiya",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -304,
        -256
      ],
      "id": "e7aa8211-88c6-48c3-a950-8cd70fed6d3c",
      "name": "Webhook",
      "webhookId": "59e5694f-83f2-4988-ad2f-4281c57d3d0d"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1sDv2vkexbHWcnR4SxVUAZW747rXFeyqKhWbldwLvrRQ/edit?gid=2042987742#gid=2042987742",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1sDv2vkexbHWcnR4SxVUAZW747rXFeyqKhWbldwLvrRQ/edit?gid=2042987742#gid=2042987742",
          "mode": "url"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "FECHA": "={{ $now.format('dd-MM-yyyy HH:mm:ss') }}",
            "NOMBRE": "={{ $json.name }}",
            "VALOR": "={{ $json.value }}"
          },
          "matchingColumns": [
            "FECHA"
          ],
          "schema": [
            {
              "id": "FECHA",
              "displayName": "FECHA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "NOMBRE",
              "displayName": "NOMBRE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "VALOR",
              "displayName": "VALOR",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "DIA",
              "displayName": "DIA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "HORA",
              "displayName": "HORA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        800,
        -176
      ],
      "id": "e36d86dc-6ce7-4d3b-9272-a512c0f8a478",
      "name": "Google Sheets",
      "retryOnFail": true,
      "maxTries": 5,
      "waitBetweenTries": 5000,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zruD3ONGC9HU2i7s",
          "name": "CUENTA SANTIAGO"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "1ee89caa-c2b1-4951-8f13-11bc950f8120",
              "leftValue": "={{ $json.body.text.toLowerCase() }}",
              "rightValue": "/recibiste/",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -80,
        -256
      ],
      "id": "61bc9a87-6556-4518-998e-1ae737c762b0",
      "name": "If"
    },
    {
      "parameters": {
        "jsCode": "// Entrada: Asumimos que el texto viene en msg.body\nconst inputText = $('Webhook').first().json.body.text;\n\n// ExpresiÃ³n regular para extraer el nombre (primer token hasta espacio)\nconst nameMatch = inputText.match(/^([\\wÂ¡!Â¿?]+)\\s/);\nconst name =\"sin nombre\";\n\n// ExpresiÃ³n regular para extraer el valor con coma o punto\nconst valueMatch = inputText.match(/\\$([\\d.,]+)/);\nlet value = valueMatch ? valueMatch[1] : null;\n\n// Normalizar el valor\nif (value) {\n    // Quitar separadores de miles (puntos)\n    value = value.replace(/\\./g, '');\n    // Reemplazar la coma decimal por nada (ignorar centavos)\n    value = value.split(',')[0];\n    // Convertir a nÃºmero entero\n    value = parseInt(value, 10);\n}\n\n// Resultado\nreturn {\n    name: name,\n    value: value\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        592,
        -176
      ],
      "id": "8a18560e-a1a4-430a-81e6-eec294550e56",
      "name": "Code"
    },
    {
      "parameters": {
        "amount": 60
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1024,
        -160
      ],
      "id": "0b404c4e-e24c-4062-acc6-2fb8ccc91d0b",
      "name": "Wait",
      "webhookId": "7d6d2d10-9ec1-4235-8077-171a333abfb0"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ef9ec435-f9c9-4e21-890a-667c38048a91",
              "leftValue": "={{ $json.body.text.toLowerCase() }}",
              "rightValue": "/acepta/",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        144,
        -288
      ],
      "id": "0c83b973-9be7-44bc-b898-10a16646e976",
      "name": "If1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://evolution.automscc.com/message/sendText/SANTIAGO-PERSONAL",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "573245904626"
            },
            {
              "name": "text",
              "value": "=ðŸ”´ MENSAJE AUTOMATICO: SE CAYÃ“ EL TRANSFIYAAAA"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        368,
        -384
      ],
      "id": "ce2965fa-7e67-42ac-8366-777d9f1f074f",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://evolution.automscc.com/message/sendText/SANTIAGO-PERSONAL",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "573245904626"
            },
            {
              "name": "text",
              "value": "=ðŸ”´ MENSAJE AUTOMATICO: SE CAYÃ“ EL TRANSFIYAAAA"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        800,
        -384
      ],
      "id": "eb68ccc0-9375-437e-9791-90cb8a7186d6",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        592,
        -384
      ],
      "id": "2dd57976-16b9-4297-bc2f-02544416acdd",
      "name": "Wait1",
      "webhookId": "d2e8938a-273b-4f0c-9cbe-c7a5bb297ea2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://evolution.automscc.com/message/sendText/SANTIAGO-PERSONAL",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "573245904626"
            },
            {
              "name": "text",
              "value": "=ðŸ”´ MENSAJE AUTOMATICO: SE CAYÃ“ EL TRANSFIYAAAA"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1248,
        -384
      ],
      "id": "c911d8ff-fd82-4a67-aff1-bd730e5a4763",
      "name": "HTTP Request2"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1024,
        -384
      ],
      "id": "c97a5df4-2c0e-4e13-b89e-42b558db88e6",
      "name": "Wait2",
      "webhookId": "d2e8938a-273b-4f0c-9cbe-c7a5bb297ea2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://evolution.automscc.com/message/sendText/SANTIAGO-PERSONAL",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "573245904626"
            },
            {
              "name": "text",
              "value": "=ðŸ”´ MENSAJE AUTOMATICO: SE CAYÃ“ EL TRANSFIYAAAA"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1680,
        -384
      ],
      "id": "5b60436a-f146-4532-893d-4717a1ef5fdc",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1472,
        -384
      ],
      "id": "843c0f65-ea9d-43e3-afea-22c395afcf8d",
      "name": "Wait3",
      "webhookId": "d2e8938a-273b-4f0c-9cbe-c7a5bb297ea2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://evolution.automscc.com/message/sendText/SANTIAGO-PERSONAL",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "573245904626"
            },
            {
              "name": "text",
              "value": "=ðŸ”´ MENSAJE AUTOMATICO: SE CAYÃ“ EL TRANSFIYAAAA"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2128,
        -384
      ],
      "id": "6b597e20-e748-48db-bf5e-6575d6068c9d",
      "name": "HTTP Request4"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1904,
        -384
      ],
      "id": "c7a134fd-0d61-4d3b-8040-8ee6f03e1718",
      "name": "Wait4",
      "webhookId": "d2e8938a-273b-4f0c-9cbe-c7a5bb297ea2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ef9ec435-f9c9-4e21-890a-667c38048a91",
              "leftValue": "={{ $json.body.text.toLowerCase() }}",
              "rightValue": "/detalle/",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        368,
        -176
      ],
      "id": "01462a50-4da0-4a4a-a8e4-8ecbae25e423",
      "name": "If2"
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "n8n.automscc.com",
            "user-agent": "SMS Forwarder App",
            "content-length": "255",
            "accept-encoding": "gzip, br",
            "cdn-loop": "cloudflare; loops=1",
            "cf-connecting-ip": "161.10.97.105",
            "cf-ipcountry": "CO",
            "cf-ray": "97c944bbcbc235b7-MIA",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "content-type": "application/json; charset=utf-8",
            "x-forwarded-for": "161.10.97.105, 172.68.12.116",
            "x-forwarded-host": "n8n.automscc.com",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "3393e017d3a9",
            "x-real-ip": "172.68.12.116"
          },
          "params": {},
          "query": {},
          "body": {
            "from": "891084",
            "text": "dale! te informa: Recibiste una transaccion por valor de $1.000,00 el 09/09/2025 a las 14:59. Consulta el detalle iniciando sesion en la App.",
            "sentStamp": 1757447990000,
            "receivedStamp": 1757447990421,
            "sim": "sim1"
          },
          "webhookUrl": "https://n8n.automscc.com/webhook/sms-transfiya",
          "executionMode": "production"
        }
      }
    ]
  },
  "repo_name": "backupn8n",
  "repo_owner": "Santiagociroc11",
  "repo_path": "backup/",
  "settings": {
    "executionOrder": "v1",
    "timezone": "America/Bogota",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-09-09T20:14:19.000Z",
  "versionId": "62af73b7-97a9-4e0f-b16e-f3033abb06ac"
}