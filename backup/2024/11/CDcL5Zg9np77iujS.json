{
  "active": false,
  "connections": {
    "Formatear grupos y mensajes": {
      "main": [
        [
          {
            "node": "Tipo de mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Procesado": {
      "main": [
        [],
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Marcar mensaje como enviado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar audio": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar media": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar audio1": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Formatear grupos y mensajes",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Formatear grupos y mensajes1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatear grupos y mensajes1": {
      "main": [
        [
          {
            "node": "Tipo de mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar media3": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar media4": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Procesado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "msgs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Variables": {
      "main": [
        [
          {
            "node": "MySQL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "msgs": {
      "main": [
        [
          {
            "node": "Filtrar mensajes para enviar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Marcar mensaje como enviado": {
      "main": [
        [
          {
            "node": "Procesado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtrar mensajes para enviar": {
      "main": [
        [
          {
            "node": "Variables",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tipo de mensaje": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Enviar texto CON MENCION",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Enviar texto SIN MENCION",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Enviar media CON MENCION",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Enviar media",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Enviar audio1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Enviar audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "Enviar media4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Enviar media3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar texto SIN MENCION": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar texto CON MENCION": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar media CON MENCION": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-11-11T16:32:17.640Z",
  "id": "CDcL5Zg9np77iujS",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "[Tool] ENVÍOS PROGRAMADOS",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// Importar las variables\nlet mensaje = $('Variables').all()[0].json.mensaje;\nlet tipoMensaje = $('Filtrar mensajes para enviar').all()[0].json.tipo.value;\nlet grupoId = $('Procesado').all()[0].json.id;\n\nlet archivo = $('Filtrar mensajes para enviar').all()[0].json.Archivo;\nlet urlArchivo = archivo.length > 0 ? archivo[0].url : [];\nlet nombreArchivo = archivo.length > 0 ? archivo[0].visible_name : [];\n\nlet tipoMedia = null;\nlet esMedia = false;\n\n// Identificar si es un mensaje de tipo media\nswitch (tipoMensaje) {\n  case \"IMAGEN\":\n    tipoMedia = \"image\";\n    esMedia = true;\n    break;\n  case \"VIDEO\":\n    tipoMedia = \"video\";\n    esMedia = true;\n    break;\n  case \"DOCUMENTO\":\n    tipoMedia = \"document\";\n    esMedia = true;\n    break;\n  case \"AUDIO\":\n    tipoMedia = \"audio\";\n    esMedia = false;\n    break;\n    \n    case \"PTV\":\n    tipoMedia = \"ptv\";\n    esMedia = false;\n    break;\n}\n\n// Formatear cada grupo con su mensaje\nlet resultado = {\n  grupo_id: grupoId,\n  mensaje: mensaje,\n  tipoMensaje: tipoMensaje,\n  urlArchivo: urlArchivo,\n  tipoMedia: tipoMedia,\n  esMedia: esMedia,\n  nombreArchivo: nombreArchivo\n};\n\n// Devolver resultado\nreturn resultado;\n"
      },
      "id": "d7f2188a-0e4c-46ea-818d-389703a4a00b",
      "name": "Formatear grupos y mensajes",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5000,
        -80
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "28510568-194c-49cd-ad13-c105809b96d4",
      "name": "Procesado",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        3980,
        0
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node[\"Variables\"].json['Url Evolution API'].replace(/\\/$/, \"\") }}/message/sendMedia/{{ $node[\"Variables\"].json['Instancia Evolution API'] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $node[\"Variables\"].json['Apikey Evolution API'] }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"number\": \"{{$('Formatear grupos y mensajes').all()[0].json.grupo_id}}\",\n    \"mediatype\": \"{{$('Formatear grupos y mensajes').all()[0].json.tipoMedia}}\", \n    \"caption\": \"{{$('Formatear grupos y mensajes').all()[0].json.mensaje}}\",\n    \"media\": \"{{$('Formatear grupos y mensajes').all()[0].json.urlArchivo}}\", \n    \"fileName\": \"{{$('Formatear grupos y mensajes').all()[0].json.nombreArchivo}}\"\n}",
        "options": {}
      },
      "id": "df18120d-5edf-450c-81a2-bcb1af99adb7",
      "name": "Enviar media",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        6220,
        -280
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node[\"Variables\"].json['Url Evolution API'].replace(/\\/$/, \"\") }}/message/sendWhatsAppAudio/{{ $node[\"Variables\"].json['Instancia Evolution API'] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $node[\"Variables\"].json['Apikey Evolution API'] }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $json.grupo_id }}"
            },
            {
              "name": "audio",
              "value": "={{$('Formatear grupos y mensajes').all()[0].json.urlArchivo}}"
            },
            {
              "name": "encoding",
              "value": "={{ true }}"
            }
          ]
        },
        "options": {}
      },
      "id": "b949693a-9053-43b4-8daa-99ec047d7dbd",
      "name": "Enviar audio",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        6220,
        20
      ]
    },
    {
      "parameters": {
        "amount": "={{ Math.random() * ($('Filtrar mensajes para enviar').all()[0].json.Maximo - $('Filtrar mensajes para enviar').all()[0].json.Minimo + Number.EPSILON) + $('Filtrar mensajes para enviar').all()[0].json.Minimo}}\n"
      },
      "id": "543b5a82-ff02-40f0-8ce2-6ab674eabacc",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        6720,
        280
      ],
      "webhookId": "ecc834c9-ff53-4cd6-ad14-534d8919934b"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node[\"Variables\"].json['Url Evolution API'].replace(/\\/$/, \"\") }}/message/sendWhatsAppAudio/{{ $node[\"Variables\"].json['Instancia Evolution API'] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $node[\"Variables\"].json['Apikey Evolution API'] }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{$('Formatear grupos y mensajes').all()[0].json.grupo_id}}"
            },
            {
              "name": "audio",
              "value": "={{$('Formatear grupos y mensajes').all()[0].json.urlArchivo}}"
            },
            {
              "name": "encoding",
              "value": "={{ true }}"
            },
            {
              "name": "mentionsEveryOne",
              "value": "={{ true }}"
            }
          ]
        },
        "options": {}
      },
      "id": "ea29b02a-6ddd-41c2-bf79-0de1ca7625f7",
      "name": "Enviar audio1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        6220,
        -120
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "21790817-89cc-4383-a52f-aa825889b94e",
              "leftValue": "={{ $('Filtrar mensajes para enviar').all()[0].json.Archivo}}",
              "rightValue": "",
              "operator": {
                "type": "array",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "17f574e6-b9ee-4e40-b836-8953f28d7db4",
      "name": "If1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4700,
        40
      ]
    },
    {
      "parameters": {
        "jsCode": "// Importar las variables\nlet mensaje = $('Variables').all()[0].json.mensaje;\nlet tipoMensaje = $('Filtrar mensajes para enviar').all()[0].json.tipo.value;\nlet grupoId = $('Procesado').all()[0].json.id;\n\n// Formatear cada grupo con su mensaje\nlet resultado = {\n  grupo_id: grupoId,\n  mensaje: mensaje,\n  tipoMensaje: tipoMensaje,\n  esMedia: false\n};\n\n// Devolver resultado\nreturn resultado;\n"
      },
      "id": "99869d90-e28a-4324-8375-e497838d08e9",
      "name": "Formatear grupos y mensajes1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5000,
        100
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node[\"Variables\"].json['Url Evolution API'].replace(/\\/$/, \"\") }}/message/sendPtv/{{ $node[\"Variables\"].json['Instancia Evolution API'] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $node[\"Variables\"].json['Apikey Evolution API'] }}"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{$('Formatear grupos y mensajes').all()[0].json.grupo_id}}"
            },
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "011db39a-9a4c-4611-b2e1-0d86eb76b45f",
      "name": "Enviar media3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        6000,
        300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node[\"Variables\"].json['Url Evolution API'].replace(/\\/$/, \"\") }}/message/sendPtv/{{ $node[\"Variables\"].json['Instancia Evolution API'] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $node[\"Variables\"].json['Apikey Evolution API'] }}"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{$('Formatear grupos y mensajes').all()[0].json.grupo_id}}"
            },
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            },
            {
              "name": "mentionsEveryOne",
              "value": "={{ true }}"
            }
          ]
        },
        "options": {}
      },
      "id": "0599b9a6-630e-4d6e-ac53-c596344c32e9",
      "name": "Enviar media4",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        6000,
        140
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b824522e-1182-46ff-8d88-1810854c8caf",
              "leftValue": "={{ $json.tipo }}",
              "rightValue": "/normal/",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "b017a351-1121-4326-99fc-b1921907c6ed",
      "name": "If2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3700,
        220
      ]
    },
    {
      "parameters": {
        "url": "={{ $('Variables').all()[0].json['Url Evolution API'] }}group/findGroupInfos/{{ $('Variables').all()[0].json['Instancia Evolution API'] }}?groupJid={{ $('Procesado').all()[0].json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $node[\"Variables\"].json['Apikey Evolution API'] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "6fb56408-df8a-4217-a384-aba62725ca16",
      "name": "HTTP Request2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4240,
        40
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2bbf4c6d-08af-470a-bdee-d4c0ef508677",
              "leftValue": "={{ $('HTTP Request2').all()[0].json.size }}",
              "rightValue": "={{ $('Filtrar mensajes para enviar').all()[0].json['TAMAÑO DE GRUPO'].toNumber() }}",
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "08f5ad3d-bf7b-4189-978b-94bc0ad133ab",
      "name": "If3",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4460,
        40
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "={{ $('Filtrar mensajes para enviar').item.json.grupos.value }}",
          "mode": "name"
        },
        "options": {}
      },
      "id": "8ec7b091-e3d4-490a-8766-499d69cd81c6",
      "name": "MySQL",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        3520,
        220
      ],
      "credentials": {
        "mySql": {
          "id": "steiUYgtMeBLjkId",
          "name": "N8N"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 1
            }
          ]
        }
      },
      "id": "f25bf670-bb4d-43be-9eff-589603d8fea8",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        2640,
        220
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3ce61d2a-015a-452b-afd8-c993e37ce897",
              "name": "Url Evolution API",
              "value": "https://evolution.automscc.com/",
              "type": "string"
            },
            {
              "id": "5e949047-3af3-472c-b1ba-0141716387ee",
              "name": "Apikey Evolution API",
              "value": "429683C4C977415CAAFCCE10F7D57E11",
              "type": "string"
            },
            {
              "id": "5169ae17-73eb-4f0a-9c63-eef1aa533e65",
              "name": "Instancia Evolution API",
              "value": "={{ $json.INSTANCIA.value }}",
              "type": "string"
            },
            {
              "id": "1a03324f-ff46-4c35-86f7-5ffee90a2da3",
              "name": "mensaje",
              "value": "={{ $json.Mensaje.replace(/\\\\/g, \"\\\\\\\\\").replace(/\\n/g, \"\\\\n\").replace(/\"/g, '\\\\\"') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "1610fcb0-ae5d-4e5d-a431-9c42c028f275",
      "name": "Variables",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        3320,
        220
      ]
    },
    {
      "parameters": {
        "databaseId": 64,
        "tableId": 335,
        "returnAll": true,
        "additionalOptions": {
          "filters": {
            "fields": [
              {
                "field": 5446,
                "operator": "empty"
              }
            ]
          }
        }
      },
      "id": "98eee508-03f3-4fbf-b723-83f917e2533e",
      "name": "msgs",
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        2860,
        220
      ],
      "credentials": {
        "baserowApi": {
          "id": "AnyMtAsWsM8u1RCq",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "databaseId": 64,
        "tableId": 335,
        "rowId": "={{ $('Filtrar mensajes para enviar').all()[0].json.id }}",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": 5446,
              "fieldValue": "={{ true }}"
            }
          ]
        }
      },
      "id": "a4312c07-c1ad-4af2-b77b-c7bffdc5faca",
      "name": "Marcar mensaje como enviado",
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        6900,
        280
      ],
      "credentials": {
        "baserowApi": {
          "id": "AnyMtAsWsM8u1RCq",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{$('Formatear grupos y mensajes').all()[0].json.urlArchivo}}",
        "options": {}
      },
      "id": "ddad9849-65ec-43a2-bc79-a65c2c7458b0",
      "name": "HTTP Request1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5560,
        180
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "c1b5a134-c189-47b5-8865-6101ad951566",
              "leftValue": "={{ DateTime.fromISO($json.Fecha).toFormat('dd-MM-yyyy HH:mm') }}",
              "rightValue": "={{ DateTime.fromISO($now).toFormat('dd-MM-yyyy HH:mm') }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "99f0c2d1-e0ce-46b7-b5e0-66b8b8081435",
      "name": "Filtrar mensajes para enviar",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [
        3060,
        220
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.tipoMensaje }}",
                    "rightValue": "TEXTO",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "9968c41f-6809-4d88-a495-694c6483275b",
                    "leftValue": "={{ $json.esMedia }}",
                    "rightValue": "=",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "media"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "b55839e7-5ed3-471c-8f74-0b4edc1ce531",
                    "leftValue": "={{ $json.tipoMensaje }}",
                    "rightValue": "=AUDIO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "6571a013-6686-4c3f-b0df-ace62356e867",
                    "leftValue": "={{ $json.tipoMensaje }}",
                    "rightValue": "PTV",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "PTV"
            }
          ]
        },
        "options": {}
      },
      "id": "8559ae70-6825-4ce9-9c45-65c2ef35dfe2",
      "name": "Tipo de mensaje",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        5280,
        0
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Filtrar mensajes para enviar').all()[0].json['¿MENCIÓN?'].value }}",
                    "rightValue": "SI",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "SI"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b089ed3e-b9a7-44e7-9ef5-9e71bbf65178",
                    "leftValue": "={{ $('Filtrar mensajes para enviar').all()[0].json['¿MENCIÓN?'].value }}",
                    "rightValue": "NO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "NO"
            }
          ]
        },
        "options": {}
      },
      "id": "3c997ef2-20e6-4cce-9256-eede60cd3801",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        5960,
        -660
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Filtrar mensajes para enviar').all()[0].json['¿MENCIÓN?'].value }}",
                    "rightValue": "SI",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "SI"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b089ed3e-b9a7-44e7-9ef5-9e71bbf65178",
                    "leftValue": "={{ $('Filtrar mensajes para enviar').all()[0].json['¿MENCIÓN?'].value }}",
                    "rightValue": "NO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "NO"
            }
          ]
        },
        "options": {}
      },
      "id": "017e20c7-14b5-4a00-a1fe-b6ee085da1bc",
      "name": "Switch1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        5960,
        -380
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Filtrar mensajes para enviar').all()[0].json['¿MENCIÓN?'].value }}",
                    "rightValue": "SI",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "SI"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b089ed3e-b9a7-44e7-9ef5-9e71bbf65178",
                    "leftValue": "={{ $('Filtrar mensajes para enviar').all()[0].json['¿MENCIÓN?'].value }}",
                    "rightValue": "NO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "NO"
            }
          ]
        },
        "options": {}
      },
      "id": "1c0b5922-3277-4f10-87a0-b8dcdba94861",
      "name": "Switch2",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        5960,
        -60
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Filtrar mensajes para enviar').all()[0].json['¿MENCIÓN?'].value }}",
                    "rightValue": "SI",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "SI"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b089ed3e-b9a7-44e7-9ef5-9e71bbf65178",
                    "leftValue": "={{ $('Filtrar mensajes para enviar').all()[0].json['¿MENCIÓN?'].value }}",
                    "rightValue": "NO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "NO"
            }
          ]
        },
        "options": {}
      },
      "id": "02f17612-5d57-4f37-a0b3-d1a54aa30707",
      "name": "Switch3",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        5740,
        180
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node[\"Variables\"].json['Url Evolution API'].replace(/\\/$/, \"\") }}/message/sendText/{{ $node[\"Variables\"].json['Instancia Evolution API'] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $node[\"Variables\"].json['Apikey Evolution API'] }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"number\": \"{{ $('Tipo de mensaje').all()[0].json.grupo_id }}\",\n    \"text\": \"{{ $('Tipo de mensaje').all()[0].json.mensaje }}\", \n    \"linkPreview\": false\n}\n",
        "options": {}
      },
      "id": "8ee93e2b-287a-4578-9b55-748d4e145882",
      "name": "Enviar texto SIN MENCION",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        6220,
        -600
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node[\"Variables\"].json['Url Evolution API'].replace(/\\/$/, \"\") }}/message/sendText/{{ $node[\"Variables\"].json['Instancia Evolution API'] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $node[\"Variables\"].json['Apikey Evolution API'] }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"number\": \"{{ $('Tipo de mensaje').all()[0].json.grupo_id }}\",\n    \"text\": \"{{ $('Tipo de mensaje').all()[0].json.mensaje }}\", \n    \"linkPreview\": false,\n    \"mentionsEveryOne\": true\n}",
        "options": {}
      },
      "id": "6ce0e420-af6f-4ec3-815b-8da46f898366",
      "name": "Enviar texto CON MENCION",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        6220,
        -760
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node[\"Variables\"].json['Url Evolution API'].replace(/\\/$/, \"\") }}/message/sendMedia/{{ $node[\"Variables\"].json['Instancia Evolution API'] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $node[\"Variables\"].json['Apikey Evolution API'] }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"number\": \"{{$('Formatear grupos y mensajes').all()[0].json.grupo_id}}\",\n    \"mediatype\": \"{{$('Formatear grupos y mensajes').all()[0].json.tipoMedia}}\", \n    \"caption\": \"{{$('Formatear grupos y mensajes').all()[0].json.mensaje}}\",\n    \"media\": \"{{$('Formatear grupos y mensajes').all()[0].json.urlArchivo}}\", \n    \"fileName\": \"{{$('Formatear grupos y mensajes').all()[0].json.nombreArchivo}}\",\n    \"mentionsEveryOne\": true\n}",
        "options": {}
      },
      "id": "c722537b-5f9b-46bf-b4a4-43718f3c8900",
      "name": "Enviar media CON MENCION",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        6220,
        -440
      ]
    }
  ],
  "pinData": {
    "Schedule Trigger": [
      {
        "json": {
          "timestamp": "2024-11-14T19:22:18.003-05:00",
          "Readable date": "November 14th 2024, 7:22:18 pm",
          "Readable time": "7:22:18 pm",
          "Day of week": "Thursday",
          "Year": "2024",
          "Month": "November",
          "Day of month": "14",
          "Hour": "19",
          "Minute": "22",
          "Second": "18",
          "Timezone": "America/Bogota (UTC-05:00)"
        }
      }
    ]
  },
  "repo_name": "backupn8n",
  "repo_owner": "Santiagociroc11",
  "repo_path": "backup/",
  "settings": {
    "executionOrder": "v1",
    "timezone": "America/Bogota",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "shared": [
    {
      "updatedAt": "2024-11-11T16:32:17.646Z",
      "createdAt": "2024-11-11T16:32:17.646Z",
      "role": "workflow:owner",
      "workflowId": "CDcL5Zg9np77iujS",
      "projectId": "703bt8e3CRxfBTYZ"
    }
  ],
  "staticData": {
    "node:Schedule Trigger": {
      "recurrenceRules": []
    }
  },
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-04-03T17:30:23.000Z",
  "versionId": "a28a25cf-9d7b-44e6-ab15-f37e331bebc4"
}