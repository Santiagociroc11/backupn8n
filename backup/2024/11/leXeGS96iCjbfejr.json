{
  "active": true,
  "connections": {
    "Edit Fields": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "BD GERSSON PRINCIPAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BD GERSSON PRINCIPAL": {
      "main": [
        [
          {
            "node": "ES TD?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NOMBRE": {
      "main": [
        [
          {
            "node": "busqueda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busqueda": {
      "main": [
        [
          {
            "node": "no existe?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "no existe?": {
      "main": [
        [
          {
            "node": "escritura",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "encontrar": {
      "main": [
        [
          {
            "node": "tag manychat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ES UÃ‘AS?": {
      "main": [
        [
          {
            "node": "VENEZUELA?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "BD CEJAS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ES TD?": {
      "main": [
        [
          {
            "node": "VENEZUELA?1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "BD UÃ‘AS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BD UÃ‘AS": {
      "main": [
        [
          {
            "node": "ES UÃ‘AS?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VENEZUELA?": {
      "main": [
        [
          {
            "node": "ELIMINAR +",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "NOMBRE1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VENEZUELA?1": {
      "main": [
        [
          {
            "node": "ELIMINAR +58",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "NOMBRE",
            "type": "main",
            "index": 0
          },
          {
            "node": "encontrar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NOMBRE1": {
      "main": [
        [
          {
            "node": "busqueda1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busqueda1": {
      "main": [
        [
          {
            "node": "no existe?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "no existe?1": {
      "main": [
        [
          {
            "node": "escritura1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VENEZUELA?2": {
      "main": [
        [
          {
            "node": "ELIMINAR +1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "NOMBRE2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NOMBRE2": {
      "main": [
        [
          {
            "node": "busqueda2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busqueda2": {
      "main": [
        [
          {
            "node": "no existe?2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "no existe?2": {
      "main": [
        [
          {
            "node": "escritura2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ES CEJAS?": {
      "main": [
        [
          {
            "node": "VENEZUELA?2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "BD PASTELERIA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BD CEJAS": {
      "main": [
        [
          {
            "node": "ES CEJAS?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VENEZUELA?3": {
      "main": [
        [
          {
            "node": "ELIMINAR +2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "NOMBRE3",
            "type": "main",
            "index": 0
          },
          {
            "node": "encontrar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NOMBRE3": {
      "main": [
        [
          {
            "node": "busqueda3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busqueda3": {
      "main": [
        [
          {
            "node": "no existe?3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "no existe?3": {
      "main": [
        [
          {
            "node": "escritura3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BD PASTELERIA": {
      "main": [
        [
          {
            "node": "ES PASTELERIA?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ES PASTELERIA?": {
      "main": [
        [
          {
            "node": "VENEZUELA?3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "encontrar1": {
      "main": [
        [
          {
            "node": "tag manychat1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-11-04T07:42:41.519Z",
  "id": "leXeGS96iCjbfejr",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "ðŸŸ¢ [AGENCIA] ESCRITURA Y EXPULSION DE GRUPOS",
  "nodes": [
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ffaf95ee-b40d-432a-9617-9c7a4dff4ed5",
              "name": "grupo",
              "value": "={{ $json.body.data.id }}",
              "type": "string"
            },
            {
              "id": "e3a70e61-aa10-4899-baff-8492afba8c37",
              "name": "numero",
              "value": "={{ $json.body.data.participants[0] }}",
              "type": "string"
            },
            {
              "id": "05f7d46c-8fc2-4fc3-8cfe-c7cc00bed18b",
              "name": "accion",
              "value": "={{ $json.body.data.action }}",
              "type": "string"
            },
            {
              "id": "0af64330-fa8a-48d3-a8f5-3f7f13e2c9bf",
              "name": "instancia",
              "value": "={{ $json.body.instance }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "54f53c27-014d-42f2-93f7-33262bf2ecfb",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1120,
        340
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c3ed79f5-9832-4354-ad38-2b7612c87557",
              "leftValue": "={{ $json.accion }}",
              "rightValue": "/add/",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "9cba71e9-7077-436e-a17e-7f4899eb88d8",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1300,
        340
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "webhooks-wha",
        "options": {}
      },
      "id": "05762bcb-00e3-4a1a-9d91-0c437ddcfd96",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        920,
        340
      ],
      "webhookId": "453d99b1-161b-46e8-8ac0-40581b8efbe2"
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "GERSSON_LINKS",
          "mode": "list",
          "cachedResultName": "GERSSON_LINKS"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "id",
              "value": "={{ $('If').item.json.grupo }}"
            }
          ]
        },
        "options": {}
      },
      "id": "bb1111bd-c105-4c09-8ffe-61df90078168",
      "name": "BD GERSSON PRINCIPAL",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1520,
        320
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "4J4D0oAUKKPzfhYR",
          "name": "REDIRECCIONES"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://evolution.automscc.com/group/findGroupInfos/{{ $('Edit Fields').item.json.instancia }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "groupJid",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2100,
        300
      ],
      "id": "90bfcb71-0192-47a5-ad03-4c60f2df0b83",
      "name": "NOMBRE"
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "GERSSON_L6_WHA",
          "mode": "list",
          "cachedResultName": "GERSSON_L6_WHA"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "whatsapp",
              "condition": "LIKE",
              "value": "=%{{ $('Edit Fields').item.json.numero.replace(/\\D/g, '') }}%"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        2260,
        300
      ],
      "id": "aaef5c4c-e6d2-4c6e-b81b-bc298198a2b4",
      "name": "busqueda",
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "n8fCALXWnGdmJkBN",
          "name": "CAPTACIONES"
        }
      }
    },
    {
      "parameters": {
        "table": {
          "__rl": true,
          "value": "GERSSON_L6_WHA",
          "mode": "list",
          "cachedResultName": "GERSSON_L6_WHA"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "dia",
              "value": "={{ $now.format('yyyy-MM-dd') }}"
            },
            {
              "column": "hora",
              "value": "={{ $now.format('HH:mm:ss') }}"
            },
            {
              "column": "whatsapp",
              "value": "=+{{ $('Edit Fields').item.json.numero.replace(/\\D/g, '') }}"
            },
            {
              "column": "grupo",
              "value": "={{ $('Edit Fields').item.json.grupo }}"
            },
            {
              "column": "nombre_grupo",
              "value": "={{ $('NOMBRE').item.json.subject }}"
            },
            {
              "column": "fuente",
              "value": "FB ADS"
            }
          ]
        },
        "options": {
          "detailedOutput": true
        }
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        2600,
        240
      ],
      "id": "32a3c67d-3849-40bc-b9d2-a732f3a87c10",
      "name": "escritura",
      "credentials": {
        "mySql": {
          "id": "n8fCALXWnGdmJkBN",
          "name": "CAPTACIONES"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7f3e8099-ae55-4534-a5be-217d413c0ff2",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2400,
        300
      ],
      "id": "abde33a3-3532-4158-8ef1-0894541dd9ca",
      "name": "no existe?"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution.automscc.com/group/updateParticipant/{{ $('Webhook').item.json.body.instance }}?groupJid={{ $('Edit Fields').item.json.grupo }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=\n{ \"action\": \"remove\", \n  \n  \"participants\": [ \"{{ $('Edit Fields').item.json.numero }}\" ] } ",
        "options": {}
      },
      "id": "fe055f3b-a869-46fc-a435-7c8e76f07428",
      "name": "ELIMINAR +58",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2100,
        -40
      ]
    },
    {
      "parameters": {
        "collection": "=TD-l6",
        "options": {},
        "query": "={\n  \"whatsapp\": {\n    \"$regex\": \".*{{ $('Edit Fields').item.json.numero.replace(/\\D/g, \"\").slice(-6) }}.*\",\n    \"$options\": \"i\"\n  }\n}"
      },
      "id": "5050bc71-0a7f-4743-8e5c-2990400df735",
      "name": "encontrar",
      "type": "n8n-nodes-base.mongoDb",
      "typeVersion": 1.1,
      "position": [
        2100,
        120
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mongoDb": {
          "id": "vbsT0SoMA5A3acgH",
          "name": "BASE DE DATOS GERSSON"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.manychat.com/fb/subscriber/addTagByName",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 288702267651723:f96a1f26344892df99c98292741de8c9"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"subscriber_id\": {{ $json.id_manychat }},\n  \"tag_name\": \"INGRESOGRUPO-L6\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2280,
        120
      ],
      "id": "f8d1b083-0e2c-4ddc-b657-deefee2de178",
      "name": "tag manychat",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "maxTries": 5,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8d2037fa-e2a7-4668-901e-4ca0a27a93ab",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "6b950143-cad3-4b26-b189-c2fbe0b08256",
      "name": "ES UÃ‘AS?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2060,
        640
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8d2037fa-e2a7-4668-901e-4ca0a27a93ab",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "3eb23b6c-4d35-4d1b-bc97-495f1adeba58",
      "name": "ES TD?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1680,
        320
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "ARZA_UÃ‘AS_LINKS",
          "mode": "list",
          "cachedResultName": "ARZA_UÃ‘AS_LINKS"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "id",
              "value": "={{ $('If').item.json.grupo }}"
            }
          ]
        },
        "options": {}
      },
      "id": "dd3162f4-ebca-4577-b101-5e143430a2e1",
      "name": "BD UÃ‘AS",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1900,
        640
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "4J4D0oAUKKPzfhYR",
          "name": "REDIRECCIONES"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6e074b0d-4663-476d-ae90-8be442f648cd",
              "leftValue": "={{ $('Edit Fields').item.json.numero }}",
              "rightValue": "58",
              "operator": {
                "type": "string",
                "operation": "startsWith"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "140accb6-76da-47b0-8539-b31efbc33924",
      "name": "VENEZUELA?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2280,
        620
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6e074b0d-4663-476d-ae90-8be442f648cd",
              "leftValue": "={{ $('Edit Fields').item.json.numero }}",
              "rightValue": "58",
              "operator": {
                "type": "string",
                "operation": "startsWith"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "6ab5d11b-90de-4ec0-b036-cfb425bba0eb",
      "name": "VENEZUELA?1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1920,
        160
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution.automscc.com/group/updateParticipant/{{ $('Webhook').item.json.body.instance }}?groupJid={{ $('Edit Fields').item.json.grupo }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=\n{ \"action\": \"remove\", \n  \n  \"participants\": [ \"{{ $('Edit Fields').item.json.numero }}\" ] } ",
        "options": {}
      },
      "id": "cdb2b909-ff01-4fe2-91a5-b73006b98d91",
      "name": "ELIMINAR +",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2480,
        500
      ]
    },
    {
      "parameters": {
        "url": "=https://evolution.automscc.com/group/findGroupInfos/{{ $('Edit Fields').item.json.instancia }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "groupJid",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2480,
        640
      ],
      "id": "db7ba858-50cd-4d94-81bb-71e353657f24",
      "name": "NOMBRE1"
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "ARZA_UÃ‘AS_WHA",
          "mode": "list",
          "cachedResultName": "ARZA_UÃ‘AS_WHA"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "whatsapp",
              "condition": "LIKE",
              "value": "=%{{ $('Edit Fields').item.json.numero.replace(/\\D/g, '') }}%"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        2640,
        640
      ],
      "id": "9f763c9d-5423-4e94-8803-04ee4d5d1893",
      "name": "busqueda1",
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "n8fCALXWnGdmJkBN",
          "name": "CAPTACIONES"
        }
      }
    },
    {
      "parameters": {
        "table": {
          "__rl": true,
          "value": "ARZA_UÃ‘AS_WHA",
          "mode": "list",
          "cachedResultName": "ARZA_UÃ‘AS_WHA"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "dia",
              "value": "={{ $now.format('yyyy-MM-dd') }}"
            },
            {
              "column": "hora",
              "value": "={{ $now.format('HH:mm:ss') }}"
            },
            {
              "column": "whatsapp",
              "value": "=+{{ $('Edit Fields').item.json.numero.replace(/\\D/g, '') }}"
            },
            {
              "column": "grupo",
              "value": "={{ $('Edit Fields').item.json.grupo }}"
            },
            {
              "column": "nombre_grupo",
              "value": "={{ $('NOMBRE1').item.json.subject }}"
            },
            {
              "column": "fuente",
              "value": "FB ADS"
            }
          ]
        },
        "options": {
          "detailedOutput": true
        }
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        3000,
        580
      ],
      "id": "7a25cc11-8719-4090-80b6-f7a7737a471f",
      "name": "escritura1",
      "credentials": {
        "mySql": {
          "id": "n8fCALXWnGdmJkBN",
          "name": "CAPTACIONES"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7f3e8099-ae55-4534-a5be-217d413c0ff2",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2800,
        640
      ],
      "id": "19423da8-51b0-4db7-90e5-29b2e23cd75f",
      "name": "no existe?1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6e074b0d-4663-476d-ae90-8be442f648cd",
              "leftValue": "={{ $('Edit Fields').item.json.numero }}",
              "rightValue": "58",
              "operator": {
                "type": "string",
                "operation": "startsWith"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "25c499e3-8a5c-4a0d-afdb-2cb74e739218",
      "name": "VENEZUELA?2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2720,
        940
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution.automscc.com/group/updateParticipant/{{ $('Webhook').item.json.body.instance }}?groupJid={{ $('Edit Fields').item.json.grupo }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=\n{ \"action\": \"remove\", \n  \n  \"participants\": [ \"{{ $('Edit Fields').item.json.numero }}\" ] } ",
        "options": {}
      },
      "id": "9aa73e0d-3d4c-4f7e-988e-2a0cb8f9c3f1",
      "name": "ELIMINAR +1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2880,
        840
      ]
    },
    {
      "parameters": {
        "url": "=https://evolution.automscc.com/group/findGroupInfos/{{ $('Edit Fields').item.json.instancia }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "groupJid",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2880,
        1000
      ],
      "id": "ec91bd65-9b51-4ed9-8129-7b3d542b355b",
      "name": "NOMBRE2"
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "ARZA_CEJAS_WHA",
          "mode": "list",
          "cachedResultName": "ARZA_CEJAS_WHA"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "whatsapp",
              "condition": "LIKE",
              "value": "=%{{ $('Edit Fields').item.json.numero.replace(/\\D/g, '') }}%"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        3040,
        1000
      ],
      "id": "37f55191-4ea4-495c-9b1f-5aa0d7c8f6d8",
      "name": "busqueda2",
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "n8fCALXWnGdmJkBN",
          "name": "CAPTACIONES"
        }
      }
    },
    {
      "parameters": {
        "table": {
          "__rl": true,
          "value": "ARZA_CEJAS_WHA",
          "mode": "list",
          "cachedResultName": "ARZA_CEJAS_WHA"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "dia",
              "value": "={{ $now.format('yyyy-MM-dd') }}"
            },
            {
              "column": "hora",
              "value": "={{ $now.format('HH:mm:ss') }}"
            },
            {
              "column": "whatsapp",
              "value": "=+{{ $('Edit Fields').item.json.numero.replace(/\\D/g, '') }}"
            },
            {
              "column": "grupo",
              "value": "={{ $('Edit Fields').item.json.grupo }}"
            },
            {
              "column": "nombre_grupo",
              "value": "={{ $('NOMBRE2').item.json.subject }}"
            },
            {
              "column": "fuente",
              "value": "FB ADS"
            }
          ]
        },
        "options": {
          "detailedOutput": true
        }
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        3400,
        940
      ],
      "id": "671d552c-ddd3-4ecd-8c3b-0beaeeb449c5",
      "name": "escritura2",
      "credentials": {
        "mySql": {
          "id": "n8fCALXWnGdmJkBN",
          "name": "CAPTACIONES"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7f3e8099-ae55-4534-a5be-217d413c0ff2",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3200,
        1000
      ],
      "id": "35466bc9-7cbf-4ef4-9b48-4157787ddbfb",
      "name": "no existe?2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8d2037fa-e2a7-4668-901e-4ca0a27a93ab",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "eab4e53b-93ee-40f5-92e0-2c16ad5058af",
      "name": "ES CEJAS?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2500,
        960
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "ARZA_CEJAS_LINKS",
          "mode": "list",
          "cachedResultName": "ARZA_CEJAS_LINKS"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "id",
              "value": "={{ $('If').item.json.grupo }}"
            }
          ]
        },
        "options": {}
      },
      "id": "cc10a74c-fc32-4319-b802-4ec081e7e6e4",
      "name": "BD CEJAS",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        2340,
        960
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "4J4D0oAUKKPzfhYR",
          "name": "REDIRECCIONES"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6e074b0d-4663-476d-ae90-8be442f648cd",
              "leftValue": "={{ $('Edit Fields').item.json.numero }}",
              "rightValue": "58",
              "operator": {
                "type": "string",
                "operation": "startsWith"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "f777e5fb-427b-4f80-ac85-d3b64a5e1186",
      "name": "VENEZUELA?3",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3120,
        1320
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution.automscc.com/group/updateParticipant/{{ $('Webhook').item.json.body.instance }}?groupJid={{ $('Edit Fields').item.json.grupo }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=\n{ \"action\": \"remove\", \n  \n  \"participants\": [ \"{{ $('Edit Fields').item.json.numero }}\" ] } ",
        "options": {}
      },
      "id": "d2c77d16-abb9-4af2-afa1-23cab0822d30",
      "name": "ELIMINAR +2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3320,
        1160
      ]
    },
    {
      "parameters": {
        "url": "=https://evolution.automscc.com/group/findGroupInfos/{{ $('Edit Fields').item.json.instancia }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "groupJid",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "429683C4C977415CAAFCCE10F7D57E11"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3320,
        1480
      ],
      "id": "1330f65b-3946-4274-af1c-1742272a7d8f",
      "name": "NOMBRE3"
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "ARZA_PASTELERIA_L1_WHA",
          "mode": "list",
          "cachedResultName": "ARZA_PASTELERIA_L1_WHA"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "whatsapp",
              "condition": "LIKE",
              "value": "=%{{ $('Edit Fields').item.json.numero.replace(/\\D/g, '') }}%"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        3480,
        1480
      ],
      "id": "398cefa0-790a-45b9-abfe-13b9871517ba",
      "name": "busqueda3",
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "n8fCALXWnGdmJkBN",
          "name": "CAPTACIONES"
        }
      }
    },
    {
      "parameters": {
        "table": {
          "__rl": true,
          "value": "ARZA_PASTELERIA_L1_WHA",
          "mode": "list",
          "cachedResultName": "ARZA_PASTELERIA_L1_WHA"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "dia",
              "value": "={{ $now.format('yyyy-MM-dd') }}"
            },
            {
              "column": "hora",
              "value": "={{ $now.format('HH:mm:ss') }}"
            },
            {
              "column": "whatsapp",
              "value": "=+{{ $('Edit Fields').item.json.numero.replace(/\\D/g, '') }}"
            },
            {
              "column": "grupo",
              "value": "={{ $('Edit Fields').item.json.grupo }}"
            },
            {
              "column": "nombre_grupo",
              "value": "={{ $('NOMBRE3').item.json.subject }}"
            },
            {
              "column": "fuente",
              "value": "FB ADS"
            }
          ]
        },
        "options": {
          "detailedOutput": true
        }
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        3840,
        1420
      ],
      "id": "28c3cb0f-a2a5-4732-957e-521cc6c1a209",
      "name": "escritura3",
      "credentials": {
        "mySql": {
          "id": "n8fCALXWnGdmJkBN",
          "name": "CAPTACIONES"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7f3e8099-ae55-4534-a5be-217d413c0ff2",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3640,
        1480
      ],
      "id": "f959e58a-944e-47db-992d-985857f9823e",
      "name": "no existe?3"
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "ARZA_PASTELERIA_LINKS",
          "mode": "list",
          "cachedResultName": "ARZA_PASTELERIA_LINKS"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "id",
              "value": "={{ $('If').item.json.grupo }}"
            }
          ]
        },
        "options": {}
      },
      "id": "08012130-e49f-40cf-8f88-fa72b936d1f0",
      "name": "BD PASTELERIA",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        2740,
        1340
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "4J4D0oAUKKPzfhYR",
          "name": "REDIRECCIONES"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8d2037fa-e2a7-4668-901e-4ca0a27a93ab",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "70927ae3-36d8-45df-aba6-f85f49613ff6",
      "name": "ES PASTELERIA?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2900,
        1340
      ]
    },
    {
      "parameters": {
        "collection": "=pasteleria",
        "options": {},
        "query": "={\n  \"whatsapp\": {\n    \"$regex\": \".*{{ $('Edit Fields').item.json.numero.replace(/\\D/g, \"\").slice(-6) }}.*\",\n    \"$options\": \"i\"\n  }\n}"
      },
      "id": "f73e458c-427f-4978-b7ba-116ebaebb8ac",
      "name": "encontrar1",
      "type": "n8n-nodes-base.mongoDb",
      "typeVersion": 1.1,
      "position": [
        3320,
        1300
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mongoDb": {
          "id": "JAKPCevXk5GvKOt9",
          "name": "MONGO CARLOS ARZA"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.manychat.com/fb/subscriber/addTagByName",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 1189237:5ad48c01d73704bf48fc266399a867f6"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"subscriber_id\": {{ $json.id_manychat }},\n  \"tag_name\": \"INGRESOGRUPO-L1\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3500,
        1300
      ],
      "id": "88e50a4d-b139-4885-a818-cb0cd2b5f7b1",
      "name": "tag manychat1",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "maxTries": 5,
      "onError": "continueErrorOutput"
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "n8n.automscc.com",
            "user-agent": "axios/1.7.9",
            "content-length": "402",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "n8n.automscc.com",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "3051a3bb6625",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "group-participants.update",
            "instance": "JUANCA",
            "data": {
              "id": "120363384878432671@g.us",
              "author": "",
              "participants": [
                "56998059494@s.whatsapp.net"
              ],
              "action": "add"
            },
            "destination": "https://n8n.automscc.com/webhook/webhooks-wha",
            "date_time": "2025-02-19T23:34:09.014Z",
            "sender": "573017817643@s.whatsapp.net",
            "server_url": "http://evolution.automscc.com",
            "apikey": "0A3BBB105AEA-46B2-ADAD-27FE2369B711"
          },
          "webhookUrl": "https://n8n.automscc.com/webhook/webhooks-wha",
          "executionMode": "production"
        }
      }
    ]
  },
  "repo_name": "backupn8n",
  "repo_owner": "Santiagociroc11",
  "repo_path": "backup/",
  "settings": {
    "executionOrder": "v1",
    "timezone": "America/Bogota",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-02-04T22:36:35.108Z",
      "updatedAt": "2025-02-04T22:36:35.108Z",
      "id": "HjNWwvqlBnseDfSA",
      "name": "GERSSON"
    },
    {
      "createdAt": "2025-02-20T03:14:39.493Z",
      "updatedAt": "2025-02-20T03:14:39.493Z",
      "id": "fMteddKWhaFhuYHk",
      "name": "MYSQL"
    },
    {
      "createdAt": "2025-02-04T22:36:43.008Z",
      "updatedAt": "2025-02-04T22:36:43.008Z",
      "id": "ux9yUSYJLDIzqblK",
      "name": "CARLOS ARZA"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-03-21T19:59:07.000Z",
  "versionId": "ae39bf75-bc93-4412-8207-866672232e52"
}